syntax = "proto3";

package sfu;

option go_package = "github.com/pion/ion/internal/sfu;proto";

message HealthCheckRequest {}

message HealthCheckResponse {
	string worker_id = 1;
	bool ok = 2;
}

message CreateSessionRequest {
	string session_id = 1;
    string worker_id = 2;
}

message SessionDescription {
  string type = 1; // "offer", "answer"
  string role = 2; // "publisher", "subscriber"
  string sdp  = 3;
}

message IceCandidate {
  string role = 1; // "publisher", "subscriber"
  string candidate          = 2;
  string sdp_mid            = 3;
  int32  sdp_mline_index    = 4;
  string username_fragment  = 5;
}

message Join {
}

message JoinResponse {
}

message Leave {
  string participant_id = 2;
}

message Subscribe {
  string peer_id = 1;
}

message SignalRequest {
  string session_id        = 1;
  string participant_id = 2;
  string peer_id = 3;

  oneof payload {
    Join              join      = 4;
    SessionDescription sdp      = 5;
    IceCandidate      candidate = 6;
    Leave             leave     = 7;
    Subscribe         subscribe = 8;
  }
}

message SignalResponse {
  string session_id        = 1;
  string participant_id = 2;
  string peer_id = 3;

  oneof payload {
    SessionDescription sdp      = 4;
    IceCandidate      candidate = 5;
  }
}

service SFUService {
    rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
	rpc Signal (stream SignalRequest) returns (stream SignalResponse);
}